<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant - CastMatch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #0f172a;
            color: #f1f5f9;
            height: 100vh;
            overflow: hidden;
        }

        /* Layout Container */
        .chat-layout {
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            height: 100vh;
        }

        /* Left Sidebar - Chat History */
        .chat-sidebar {
            background: #1e293b;
            border-right: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
        }

        .user-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar-nav {
            width: 36px;
            height: 36px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info-nav {
            flex: 1;
        }

        .user-name-nav {
            font-size: 14px;
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 2px;
        }

        .user-role-nav {
            font-size: 12px;
            color: #64748b;
        }

        .logout-nav-btn {
            background: none;
            border: 1px solid #334155;
            color: #64748b;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .logout-nav-btn:hover {
            background: #334155;
            color: #f1f5f9;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: #1B35FF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .new-chat-btn:hover {
            background: #1428CC;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .chat-history-title {
            padding: 0 20px 12px;
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chat-history-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .chat-history-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .chat-history-item.active {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
        }

        .chat-title {
            font-size: 14px;
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .chat-preview {
            font-size: 12px;
            color: #64748b;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .chat-timestamp {
            font-size: 11px;
            color: #475569;
            margin-top: 4px;
        }

        /* Main Chat Area */
        .chat-main {
            display: flex;
            flex-direction: column;
            background: #0f172a;
        }

        .chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .chat-info {
            display: flex;
            flex-direction: column;
        }

        .chat-name {
            font-size: 18px;
            font-weight: 600;
            color: #f1f5f9;
        }

        .chat-status {
            font-size: 14px;
            color: #22c55e;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
        }

        .chat-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #334155;
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 80%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #22c55e, #15803d);
            color: white;
        }

        .message-content {
            flex: 1;
        }

        .message-bubble {
            padding: 16px 20px;
            border-radius: 16px;
            position: relative;
            margin-bottom: 8px;
        }

        .message.ai .message-bubble {
            background: #1e293b;
            border: 1px solid #334155;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-text {
            font-size: 15px;
            line-height: 1.5;
        }

        .message-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: #64748b;
        }

        .message.user .message-meta {
            justify-content: flex-end;
        }

        .message-time {
            opacity: 0.7;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .message-action:hover {
            background: #334155;
            color: #f1f5f9;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .typing-indicator.show {
            opacity: 1;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 16px 20px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #64748b;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        /* Input Area */
        .input-container {
            padding: 24px;
            border-top: 1px solid #334155;
            background: #1e293b;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 12px;
            transition: border-color 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            color: #f1f5f9;
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            outline: none;
            min-height: 24px;
            max-height: 120px;
            overflow-y: auto;
        }

        .message-input::placeholder {
            color: #64748b;
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .attachment-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            font-size: 18px;
            transition: all 0.2s;
        }

        .attachment-btn:hover {
            background: #334155;
            color: #f1f5f9;
        }

        .send-btn {
            background: #3b82f6;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .send-btn:hover {
            background: #2563eb;
        }

        .send-btn:disabled {
            background: #475569;
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Right Sidebar - Context & Tools */
        .context-sidebar {
            background: #1e293b;
            border-left: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }

        .context-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
        }

        .context-title {
            font-size: 16px;
            font-weight: 600;
            color: #f1f5f9;
        }

        .context-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .context-section {
            margin-bottom: 24px;
        }

        .context-section-title {
            font-size: 14px;
            font-weight: 500;
            color: #94a3b8;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-item {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .context-item:hover {
            border-color: #3b82f6;
        }

        .context-item-title {
            font-size: 13px;
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .context-item-desc {
            font-size: 12px;
            color: #64748b;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .quick-action {
            background: #0f172a;
            border: 1px solid #334155;
            color: #f1f5f9;
            padding: 12px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            transition: all 0.2s;
        }

        .quick-action:hover {
            background: #334155;
        }

        /* Suggestions */
        .suggestions {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .suggestions.show {
            display: block;
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .suggestion-item:hover {
            background: #334155;
        }

        .suggestion-text {
            font-size: 14px;
            color: #f1f5f9;
        }

        .suggestion-desc {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        /* Annotations */
        .annotation {
            position: absolute;
            background: #fbbf24;
            color: #000;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .annotation::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #fbbf24;
        }

        #ann1 { top: 80px; left: 40px; }
        #ann2 { top: 200px; left: 400px; }
        #ann3 { top: 500px; left: 600px; }
        #ann4 { top: 80px; right: 40px; }
    </style>
</head>
<body>
    <!-- Annotations -->
    <div class="annotation" id="ann1">1. Chat History</div>
    <div class="annotation" id="ann2">2. Message Thread</div>
    <div class="annotation" id="ann3">3. Smart Input</div>
    <div class="annotation" id="ann4">4. Context Tools</div>

    <div class="chat-layout">
        <!-- Left Sidebar - Chat History -->
        <div class="chat-sidebar">
            <div class="user-header">
                <div class="user-avatar-nav" id="userAvatarNav">CD</div>
                <div class="user-info-nav">
                    <div class="user-name-nav" id="userNameNav">Casting Director</div>
                    <div class="user-role-nav">Premium Plan</div>
                </div>
                <button class="logout-nav-btn" onclick="logout()">Logout</button>
            </div>
            <div class="sidebar-header">
                <button class="new-chat-btn">
                    <span>+</span>
                    <span>New Chat</span>
                </button>
            </div>
            
            <div class="chat-history">
                <div class="chat-history-title">Recent Conversations</div>
                
                <div class="chat-history-item active">
                    <div class="chat-title">Talent Search for Web Series</div>
                    <div class="chat-preview">Help me find male actors aged 25-35 for a lead role in a thriller web series...</div>
                    <div class="chat-timestamp">2 hours ago</div>
                </div>
                
                <div class="chat-history-item">
                    <div class="chat-title">Audition Scheduling</div>
                    <div class="chat-preview">I need to schedule auditions for next week. What's the best way to...</div>
                    <div class="chat-timestamp">Yesterday</div>
                </div>
                
                <div class="chat-history-item">
                    <div class="chat-title">Budget Planning</div>
                    <div class="chat-preview">Can you help me estimate the casting budget for a 20-episode series?</div>
                    <div class="chat-timestamp">3 days ago</div>
                </div>
                
                <div class="chat-history-item">
                    <div class="chat-title">Location Scouting</div>
                    <div class="chat-preview">I'm looking for shooting locations in Mumbai for an outdoor commercial...</div>
                    <div class="chat-timestamp">1 week ago</div>
                </div>
                
                <div class="chat-history-item">
                    <div class="chat-title">Contract Templates</div>
                    <div class="chat-preview">What should be included in actor contracts for OTT platforms?</div>
                    <div class="chat-timestamp">1 week ago</div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main">
            <div class="chat-header">
                <div class="chat-header-left">
                    <a href="../landing-page/index-premium.html" style="text-decoration: none; color: #1B35FF; font-size: 18px; font-weight: 700; margin-right: 16px;">CastMatch</a>
                    <div class="ai-avatar">AI</div>
                    <div class="chat-info">
                        <div class="chat-name">AI Assistant</div>
                        <div class="chat-status">
                            <div class="status-dot"></div>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="window.location.href='dashboard.html'">üìä Dashboard</button>
                    <button class="action-btn">üìã Export</button>
                    <button class="action-btn">‚öôÔ∏è Settings</button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- AI Welcome Message -->
                <div class="message ai">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text" id="welcomeMessage">Hi! I'm your CastMatch AI assistant. I can help you with talent search, audition planning, contract guidance, and industry insights. What would you like to work on today?</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2:30 PM</div>
                            <div class="message-actions">
                                <button class="message-action">üëç</button>
                                <button class="message-action">üëé</button>
                                <button class="message-action">üìã</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Message -->
                <div class="message user">
                    <div class="message-avatar">CD</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">I'm casting for a lead male role in a thriller web series. The character is a detective in his early 30s. I need someone with strong dramatic acting skills and previous experience in crime/thriller genres.</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2:32 PM</div>
                        </div>
                    </div>
                </div>

                <!-- AI Response -->
                <div class="message ai">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">Perfect! I can help you find the ideal detective for your thriller series. Let me break down the search criteria:

<strong>Character Profile:</strong>
‚Ä¢ Male lead, early 30s (28-35 years)
‚Ä¢ Detective/investigative role
‚Ä¢ Thriller/crime genre experience required
‚Ä¢ Strong dramatic acting skills

I found 47 actors matching these criteria in our database. Would you like me to:

1. Show you the top 10 recommendations based on ratings and experience
2. Filter further by location (Mumbai, Delhi, etc.)
3. Include actors with specific skills (action sequences, method acting)
4. Set up initial screening calls

Which approach interests you most?</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2:33 PM</div>
                            <div class="message-actions">
                                <button class="message-action">üëç</button>
                                <button class="message-action">üëé</button>
                                <button class="message-action">üìã</button>
                                <button class="message-action">üîó</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Response -->
                <div class="message user">
                    <div class="message-avatar">CD</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">Show me the top 10 recommendations. I'm particularly interested in actors based in Mumbai who can handle action sequences as well.</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2:35 PM</div>
                        </div>
                    </div>
                </div>

                <!-- AI Response with Recommendations -->
                <div class="message ai">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">Excellent! Here are the top 10 Mumbai-based actors perfect for your detective role:

<strong>üé¨ Top Recommendations:</strong>

<strong>1. Raj Kumar Singh</strong> - ‚≠ê 4.8/5
‚Ä¢ 8+ years experience | Theatre & Film
‚Ä¢ Specializes in crime thrillers
‚Ä¢ Action sequence trained
‚Ä¢ Available immediately

<strong>2. Arjun Mehta</strong> - ‚≠ê 4.7/5  
‚Ä¢ 6+ years experience | Method actor
‚Ä¢ Previous detective roles in 3 web series
‚Ä¢ Martial arts background
‚Ä¢ Available next month

<strong>3. Vikram Sharma</strong> - ‚≠ê 4.9/5
‚Ä¢ 10+ years experience | Award winner
‚Ä¢ Crime genre specialist
‚Ä¢ Stunt work certified
‚Ä¢ Available this month

Would you like me to:
‚Ä¢ Show detailed profiles for any of these actors?
‚Ä¢ Schedule video calls with your top choices?
‚Ä¢ Send audition invitations directly?</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2:36 PM</div>
                            <div class="message-actions">
                                <button class="message-action">üëç</button>
                                <button class="message-action">üëé</button>
                                <button class="message-action">üìã</button>
                                <button class="message-action">üîó</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator">
                    <div class="message-avatar">AI</div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Input Container -->
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        class="message-input" 
                        placeholder="Ask about talent search, auditions, contracts, or industry insights..."
                        rows="1"
                    ></textarea>
                    <div class="input-actions">
                        <button class="attachment-btn" title="Attach file">üìé</button>
                        <button class="send-btn" id="sendBtn" disabled>
                            <span>Send</span>
                            <span>‚èé</span>
                        </button>
                    </div>
                </div>
                
                <!-- Smart Suggestions -->
                <div class="suggestions" id="suggestions">
                    <div class="suggestion-item">
                        <div class="suggestion-text">Show me Raj's detailed profile</div>
                        <div class="suggestion-desc">View complete portfolio and experience</div>
                    </div>
                    <div class="suggestion-item">
                        <div class="suggestion-text">Schedule auditions with top 3</div>
                        <div class="suggestion-desc">Set up video calls automatically</div>
                    </div>
                    <div class="suggestion-item">
                        <div class="suggestion-text">Create audition brief</div>
                        <div class="suggestion-desc">Generate role requirements document</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Context & Tools -->
        <div class="context-sidebar">
            <div class="context-header">
                <div class="context-title">Context & Tools</div>
            </div>
            
            <div class="context-content">
                <div class="context-section">
                    <div class="context-section-title">
                        <span>üéØ</span>
                        <span>Quick Actions</span>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action">Find Talent</button>
                        <button class="quick-action">Schedule Audition</button>
                        <button class="quick-action">Create Brief</button>
                        <button class="quick-action">Export List</button>
                    </div>
                </div>

                <div class="context-section">
                    <div class="context-section-title">
                        <span>üìä</span>
                        <span>Current Search</span>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Male Detective Role</div>
                        <div class="context-item-desc">Age 28-35, Mumbai-based, Action capable</div>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">47 Matches Found</div>
                        <div class="context-item-desc">Top 10 displayed, 37 more available</div>
                    </div>
                </div>

                <div class="context-section">
                    <div class="context-section-title">
                        <span>‚≠ê</span>
                        <span>Top Matches</span>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Raj Kumar Singh</div>
                        <div class="context-item-desc">Rating 4.8/5 ‚Ä¢ 8+ years exp</div>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Arjun Mehta</div>
                        <div class="context-item-desc">Rating 4.7/5 ‚Ä¢ Method actor</div>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Vikram Sharma</div>
                        <div class="context-item-desc">Rating 4.9/5 ‚Ä¢ Award winner</div>
                    </div>
                </div>

                <div class="context-section">
                    <div class="context-section-title">
                        <span>üîß</span>
                        <span>Tools</span>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Profile Comparison</div>
                        <div class="context-item-desc">Compare selected actors side-by-side</div>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Audition Scheduler</div>
                        <div class="context-item-desc">Book slots with shortlisted talent</div>
                    </div>
                    <div class="context-item">
                        <div class="context-item-title">Contract Generator</div>
                        <div class="context-item-desc">Create custom actor agreements</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="auth-integration.js"></script>
    <script>
        // Authentication check
        function checkAuthentication() {
            if (!authAPI.isAuthenticated()) {
                window.location.href = 'login.html';
                return false;
            }
            
            // Get user data and populate UI
            const user = authAPI.getCurrentUser();
            if (user) {
                document.getElementById('userNameNav').textContent = `${user.firstName} ${user.lastName}`;
                
                // Set avatar initials
                const initials = `${user.firstName?.[0] || 'C'}${user.lastName?.[0] || 'D'}`;
                document.getElementById('userAvatarNav').textContent = initials;
                
                // Personalize welcome message
                const welcomeMsg = document.getElementById('welcomeMessage');
                welcomeMsg.textContent = `Hi ${user.firstName || 'there'}! I'm your CastMatch AI assistant. I can help you with talent search, audition planning, contract guidance, and industry insights. What would you like to work on today?`;
            }
            
            return true;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                authAPI.logout();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (!checkAuthentication()) {
                return;
            }
            const messageInput = document.querySelector('.message-input');
            const sendBtn = document.getElementById('sendBtn');
            const messagesContainer = document.getElementById('messagesContainer');
            const typingIndicator = document.getElementById('typingIndicator');
            const suggestions = document.getElementById('suggestions');

            // Auto-resize textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                
                // Enable/disable send button
                sendBtn.disabled = !this.value.trim();
                
                // Show suggestions if typing
                if (this.value.length > 2) {
                    suggestions.classList.add('show');
                } else {
                    suggestions.classList.remove('show');
                }
            });

            // Send message
            function sendMessage() {
                const text = messageInput.value.trim();
                if (!text) return;

                // Add user message
                addMessage('user', text);
                
                // Clear input
                messageInput.value = '';
                messageInput.style.height = 'auto';
                sendBtn.disabled = true;
                suggestions.classList.remove('show');
                
                // Show typing indicator
                typingIndicator.classList.add('show');
                
                // Simulate AI response
                setTimeout(() => {
                    typingIndicator.classList.remove('show');
                    addAIResponse(text);
                }, 2000);
            }

            sendBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Suggestion clicks
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const text = this.querySelector('.suggestion-text').textContent;
                    messageInput.value = text;
                    messageInput.dispatchEvent(new Event('input'));
                    suggestions.classList.remove('show');
                    messageInput.focus();
                });
            });

            // Quick actions
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.textContent;
                    messageInput.value = `Help me ${action.toLowerCase()}`;
                    messageInput.dispatchEvent(new Event('input'));
                });
            });

            // Context item clicks
            document.querySelectorAll('.context-item').forEach(item => {
                item.addEventListener('click', function() {
                    const title = this.querySelector('.context-item-title').textContent;
                    messageInput.value = `Tell me more about ${title}`;
                    messageInput.dispatchEvent(new Event('input'));
                });
            });

            // Message actions
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('message-action')) {
                    const action = e.target.textContent;
                    switch(action) {
                        case 'üëç':
                            e.target.style.background = '#22c55e';
                            break;
                        case 'üëé':
                            e.target.style.background = '#ef4444';
                            break;
                        case 'üìã':
                            alert('Message copied to clipboard');
                            break;
                        case 'üîó':
                            alert('Message link copied');
                            break;
                    }
                }
            });

            function addMessage(type, text) {
                const message = document.createElement('div');
                message.className = `message ${type}`;
                
                const avatar = type === 'user' ? 'CD' : 'AI';
                const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                message.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">${text}</div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">${time}</div>
                            ${type === 'ai' ? `
                                <div class="message-actions">
                                    <button class="message-action">üëç</button>
                                    <button class="message-action">üëé</button>
                                    <button class="message-action">üìã</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                messagesContainer.insertBefore(message, typingIndicator);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function addAIResponse(userText) {
                let response = "I understand you're looking for assistance. Let me help you with that.";
                
                if (userText.toLowerCase().includes('profile') || userText.toLowerCase().includes('raj')) {
                    response = `Here's Raj Kumar Singh's detailed profile:

<strong>üé≠ Professional Overview</strong>
‚Ä¢ Name: Raj Kumar Singh
‚Ä¢ Age: 32 years
‚Ä¢ Location: Mumbai, Maharashtra
‚Ä¢ Experience: 8+ years in film and theater
‚Ä¢ Rating: 4.8/5 (based on 127 reviews)

<strong>üèÜ Specializations</strong>
‚Ä¢ Crime/Thriller genres
‚Ä¢ Method acting techniques
‚Ä¢ Action sequence training
‚Ä¢ Emotional range: Drama, Suspense, Action

<strong>üìã Recent Projects</strong>
‚Ä¢ "Mumbai Nights" (Lead Detective) - 2023
‚Ä¢ "The Investigation" (Supporting) - 2022
‚Ä¢ "Crime Patrol" (Guest appearances) - 2021-2023

Would you like to schedule a video call or send him an audition invitation?`;
                }
                
                addMessage('ai', response);
            }

            // Hide annotations after 5 seconds
            setTimeout(() => {
                document.querySelectorAll('.annotation').forEach(ann => {
                    ann.style.opacity = '0';
                    ann.style.transition = 'opacity 0.5s';
                });
            }, 5000);
        });
    </script>
</body>
</html>