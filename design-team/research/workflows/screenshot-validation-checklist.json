{
  "version": "2.0",
  "lastUpdated": "2025-01-13",
  "purpose": "Ensure high-quality, correctly attributed screenshots",
  
  "preCapture": {
    "environment": [
      {
        "check": "Playwright installed",
        "command": "npm list playwright",
        "required": true
      },
      {
        "check": "Chromium browser available",
        "command": "npx playwright install chromium",
        "required": true
      },
      {
        "check": "Output directories created",
        "paths": ["screenshots/", "screenshots/_metadata/", "screenshots/_rejected/"],
        "required": true
      },
      {
        "check": "Network connection stable",
        "testUrl": "https://dribbble.com",
        "required": true
      }
    ],
    "configuration": [
      {
        "check": "Profile URLs verified",
        "validation": "Ensure URLs match current Dribbble profile structure",
        "required": true
      },
      {
        "check": "Viewport dimensions set",
        "recommended": {"width": 1920, "height": 1080},
        "required": true
      },
      {
        "check": "Rate limiting configured",
        "delays": {"min": 3000, "max": 7000},
        "required": true
      }
    ]
  },
  
  "duringCapture": {
    "pageLoadValidation": [
      {
        "indicator": "DOM Content Loaded",
        "selector": "document.readyState === 'complete'",
        "timeout": 30000,
        "critical": true
      },
      {
        "indicator": "Network Idle",
        "description": "No network requests for 500ms",
        "timeout": 30000,
        "critical": true
      },
      {
        "indicator": "Images Loaded",
        "validation": "All img elements have naturalHeight > 0",
        "selector": "img",
        "timeout": 30000,
        "critical": true
      },
      {
        "indicator": "Dribbble CDN Content",
        "selector": "img[src*='cdn.dribbble']",
        "minCount": 1,
        "timeout": 20000,
        "critical": true
      },
      {
        "indicator": "No Loading Spinners",
        "selectors": [".spinner", ".loader", ".loading", "[class*='load']", ".skeleton"],
        "expectedState": "hidden or absent",
        "timeout": 15000,
        "critical": true
      },
      {
        "indicator": "Stability Buffer",
        "waitTime": 5000,
        "description": "Additional wait to ensure dynamic content settles",
        "critical": false
      }
    ],
    
    "profileOwnershipValidation": [
      {
        "check": "Profile Link on List View",
        "selectors": ["a.hoverable", "a[href*='/profilename']"],
        "location": "Shot list/grid view",
        "critical": true
      },
      {
        "check": "Author Link on Detail View",
        "selectors": [
          "a[href*='/profilename']",
          ".shot-user a[href*='profilename']",
          ".attribution a[href*='profilename']"
        ],
        "location": "Individual shot page",
        "critical": true
      },
      {
        "check": "Profile Name in URL",
        "pattern": "/profilename/",
        "location": "Browser URL",
        "critical": false
      }
    ],
    
    "contentQualityChecks": [
      {
        "metric": "Main Content Height",
        "selector": ".shot-content, .media-content, [class*='shot']",
        "minHeight": 100,
        "unit": "pixels",
        "critical": true
      },
      {
        "metric": "Image Load Status",
        "check": "img.complete && img.naturalHeight > 0",
        "threshold": "100%",
        "critical": true
      },
      {
        "metric": "Error States",
        "selectors": [".error", ".not-found", "[class*='404']"],
        "expectedCount": 0,
        "critical": true
      },
      {
        "metric": "Content Bounds",
        "description": "Verify content is within viewport",
        "maxWidth": 1920,
        "maxHeight": 1080,
        "critical": false
      }
    ]
  },
  
  "postCapture": {
    "fileValidation": [
      {
        "check": "File Created",
        "extension": ".png",
        "minSize": "10KB",
        "maxSize": "5MB",
        "critical": true
      },
      {
        "check": "Filename Format",
        "pattern": "{profile}_{index}_{timestamp}_{title}.png",
        "example": "glebich_001_143025_mobile-app-design.png",
        "critical": false
      },
      {
        "check": "File Permissions",
        "permissions": "644",
        "description": "Readable by all, writable by owner",
        "critical": false
      }
    ],
    
    "metadataGeneration": [
      {
        "field": "profile",
        "type": "string",
        "required": true
      },
      {
        "field": "captureDate",
        "type": "ISO 8601 timestamp",
        "required": true
      },
      {
        "field": "shot.url",
        "type": "URL",
        "pattern": "https://dribbble.com/shots/*",
        "required": true
      },
      {
        "field": "shot.title",
        "type": "string",
        "required": true
      },
      {
        "field": "qualityChecks",
        "type": "object",
        "requiredFields": ["imagesLoaded", "contentVisible", "noLoaders", "noErrors"],
        "required": true
      },
      {
        "field": "attempt",
        "type": "number",
        "min": 1,
        "max": 3,
        "required": true
      }
    ],
    
    "reportGeneration": [
      {
        "section": "Summary Statistics",
        "requiredMetrics": ["totalShots", "successfulCaptures", "rejectedCaptures", "successRate"],
        "format": "markdown",
        "required": true
      },
      {
        "section": "Individual Shot Details",
        "requiredFields": ["filename", "url", "qualityChecks", "attempts"],
        "format": "markdown list",
        "required": true
      },
      {
        "section": "Performance Metrics",
        "requiredMetrics": ["executionTime", "averageTimePerShot"],
        "format": "markdown",
        "required": false
      }
    ]
  },
  
  "qualityGates": {
    "minimum": {
      "successRate": 70,
      "description": "Minimum acceptable success rate for batch capture"
    },
    "target": {
      "successRate": 90,
      "description": "Target success rate for optimal performance"
    },
    "exceptional": {
      "successRate": 95,
      "description": "Exceptional performance indicator"
    }
  },
  
  "namingConventions": {
    "screenshots": {
      "pattern": "{profile}_{index}_{timestamp}_{title}.png",
      "indexFormat": "3-digit zero-padded (001, 002, ...)",
      "timestampFormat": "HHmmss",
      "titleFormat": "lowercase, hyphen-separated, max 50 chars"
    },
    "metadata": {
      "pattern": "{profile}_{unixTimestamp}.json",
      "example": "glebich_1736789234567.json"
    },
    "reports": {
      "pattern": "report_{profile}_{unixTimestamp}.md",
      "example": "report_uxerflow_1736789234567.md"
    }
  },
  
  "folderOrganization": {
    "structure": {
      "root": "screenshots/",
      "profiles": "screenshots/{profileName}/",
      "daily": "screenshots/{profileName}/{YYYY-MM-DD}/",
      "metadata": "screenshots/_metadata/",
      "rejected": "screenshots/_rejected/",
      "archives": "screenshots/_archives/{YYYY-MM}/"
    },
    "maintenance": {
      "archiveAfter": "30 days",
      "deleteRejectedAfter": "7 days",
      "compressArchives": true
    }
  },
  
  "commonIssues": {
    "loadingStates": {
      "symptoms": ["Spinners visible", "Placeholder images", "Skeleton screens"],
      "solution": "Increase wait times, add multiple validation strategies",
      "preventionCode": "await waitForFullLoad(page)"
    },
    "wrongProfile": {
      "symptoms": ["Shots from 'popular' section", "Mixed designer content"],
      "solution": "Verify author links on both list and detail views",
      "preventionCode": "await verifyProfileOwnership(page, profileName)"
    },
    "partialContent": {
      "symptoms": ["Cut-off images", "Missing sections", "Incomplete renders"],
      "solution": "Wait for all images to load, check content bounds",
      "preventionCode": "await page.waitForFunction(() => images.every(img => img.complete))"
    },
    "rateLimiting": {
      "symptoms": ["403 errors", "Captcha challenges", "Blocked requests"],
      "solution": "Add random delays between captures (3-7 seconds)",
      "preventionCode": "await page.waitForTimeout(getRandomDelay())"
    },
    "memoryLeaks": {
      "symptoms": ["Increasing memory usage", "Browser crashes", "Slow performance"],
      "solution": "Restart browser context every 20 captures",
      "preventionCode": "if (i % 20 === 0) await restartContext()"
    }
  },
  
  "maintenanceSchedule": {
    "daily": [
      "Check for Dribbble UI changes",
      "Verify selector accuracy",
      "Review rejection logs"
    ],
    "weekly": [
      "Update profile verification selectors",
      "Archive old screenshots",
      "Analyze success rate trends"
    ],
    "monthly": [
      "Full selector audit",
      "Performance optimization review",
      "Update documentation"
    ]
  }
}