# PostgreSQL Client Authentication Configuration File
# Production security settings for CastMatch

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections for maintenance
local   all             postgres                                peer
local   all             castmatch_user                         md5
local   replication     postgres                                peer
local   replication     replicator                             md5

# IPv4 local connections
host    all             postgres        127.0.0.1/32           md5
host    all             castmatch_user  127.0.0.1/32           md5

# Application connections (adjust IP ranges for your infrastructure)
host    castmatch_production castmatch_user  10.0.0.0/8        scram-sha-256
host    castmatch_production castmatch_user  172.16.0.0/12     scram-sha-256
host    castmatch_production castmatch_user  192.168.0.0/16    scram-sha-256

# PgBouncer connections
host    castmatch_production castmatch_user  pgbouncer          scram-sha-256

# Read-only user for monitoring and analytics
host    castmatch_production castmatch_readonly 10.0.0.0/8     scram-sha-256
host    castmatch_production castmatch_readonly 172.16.0.0/12  scram-sha-256
host    castmatch_production castmatch_readonly 192.168.0.0/16 scram-sha-256

# Replication connections
host    replication     replicator      10.0.0.0/8             scram-sha-256
host    replication     replicator      172.16.0.0/12          scram-sha-256
host    replication     replicator      192.168.0.0/16         scram-sha-256

# SSL connections for remote access
hostssl castmatch_production castmatch_user  0.0.0.0/0         scram-sha-256
hostssl replication     replicator      0.0.0.0/0              scram-sha-256

# Backup user connections
host    all             castmatch_backup 10.0.0.0/8            scram-sha-256
hostssl all             castmatch_backup 0.0.0.0/0             scram-sha-256

# Monitoring connections
host    postgres        castmatch_monitor 10.0.0.0/8          scram-sha-256
host    postgres        castmatch_monitor 172.16.0.0/12       scram-sha-256

# Reject all other connections
host    all             all             0.0.0.0/0              reject